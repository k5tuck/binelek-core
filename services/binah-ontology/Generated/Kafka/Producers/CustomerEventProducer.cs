// <auto-generated />
// Generated from SupplyChainOntology vv1.0.0

using System;
using System.Text;
using System.Threading.Tasks;
using Confluent.Kafka;
using Microsoft.Extensions.Logging;
using Acme.SupplyChain.Kafka.Events;

namespace Acme.SupplyChain.Kafka.Producers
{
    /// <summary>
    /// Typed Kafka producer for Customer events
    /// </summary>
    public class CustomerEventProducer : ICustomerEventProducer
    {
        private readonly IProducer<string, CustomerCreatedEvent> _createdProducer;
        private readonly IProducer<string, CustomerUpdatedEvent> _updatedProducer;
        private readonly IProducer<string, CustomerDeletedEvent> _deletedProducer;
        private readonly ILogger<CustomerEventProducer> _logger;

        public CustomerEventProducer(
            IProducer<string, CustomerCreatedEvent> createdProducer,
            IProducer<string, CustomerUpdatedEvent> updatedProducer,
            IProducer<string, CustomerDeletedEvent> deletedProducer,
            ILogger<CustomerEventProducer> logger)
        {
            _createdProducer = createdProducer ?? throw new ArgumentNullException(nameof(createdProducer));
            _updatedProducer = updatedProducer ?? throw new ArgumentNullException(nameof(updatedProducer));
            _deletedProducer = deletedProducer ?? throw new ArgumentNullException(nameof(deletedProducer));
            _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        }

        public async Task PublishCreatedAsync(CustomerCreatedEvent evt)
        {
            try
            {
                var result = await _createdProducer.ProduceAsync(
                    KafkaTopics.OntologyEntityCreated,
                    new Message<string, CustomerCreatedEvent>
                    {
                        Key = evt.EntityId,
                        Value = evt,
                        Headers = new Headers
                        {
                            { "entity-type", Encoding.UTF8.GetBytes("Customer") },
                            { "event-type", Encoding.UTF8.GetBytes("Created") },
                            { "tenant-id", Encoding.UTF8.GetBytes(evt.TenantId) }
                        }
                    }
                );

                _logger.LogInformation("CustomerCreated event published to {Topic} at offset {Offset}",
                    result.Topic, result.Offset);
            }
            catch (ProduceException<string, CustomerCreatedEvent> ex)
            {
                _logger.LogError(ex, "Failed to publish CustomerCreated event");
                throw;
            }
        }

        public async Task PublishUpdatedAsync(CustomerUpdatedEvent evt)
        {
            try
            {
                var result = await _updatedProducer.ProduceAsync(
                    KafkaTopics.OntologyEntityUpdated,
                    new Message<string, CustomerUpdatedEvent>
                    {
                        Key = evt.EntityId,
                        Value = evt,
                        Headers = new Headers
                        {
                            { "entity-type", Encoding.UTF8.GetBytes("Customer") },
                            { "event-type", Encoding.UTF8.GetBytes("Updated") },
                            { "tenant-id", Encoding.UTF8.GetBytes(evt.TenantId) }
                        }
                    }
                );

                _logger.LogInformation("CustomerUpdated event published to {Topic} at offset {Offset}",
                    result.Topic, result.Offset);
            }
            catch (ProduceException<string, CustomerUpdatedEvent> ex)
            {
                _logger.LogError(ex, "Failed to publish CustomerUpdated event");
                throw;
            }
        }

        public async Task PublishDeletedAsync(CustomerDeletedEvent evt)
        {
            try
            {
                var result = await _deletedProducer.ProduceAsync(
                    KafkaTopics.OntologyEntityDeleted,
                    new Message<string, CustomerDeletedEvent>
                    {
                        Key = evt.EntityId,
                        Value = evt,
                        Headers = new Headers
                        {
                            { "entity-type", Encoding.UTF8.GetBytes("Customer") },
                            { "event-type", Encoding.UTF8.GetBytes("Deleted") },
                            { "tenant-id", Encoding.UTF8.GetBytes(evt.TenantId) }
                        }
                    }
                );

                _logger.LogInformation("CustomerDeleted event published to {Topic} at offset {Offset}",
                    result.Topic, result.Offset);
            }
            catch (ProduceException<string, CustomerDeletedEvent> ex)
            {
                _logger.LogError(ex, "Failed to publish CustomerDeleted event");
                throw;
            }
        }
    }
}
