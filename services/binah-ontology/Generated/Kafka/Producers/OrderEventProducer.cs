// <auto-generated />
// Generated from SupplyChainOntology vv1.0.0

using System;
using System.Text;
using System.Threading.Tasks;
using Confluent.Kafka;
using Microsoft.Extensions.Logging;
using Acme.SupplyChain.Kafka.Events;

namespace Acme.SupplyChain.Kafka.Producers
{
    /// <summary>
    /// Typed Kafka producer for Order events
    /// </summary>
    public class OrderEventProducer : IOrderEventProducer
    {
        private readonly IProducer<string, OrderCreatedEvent> _createdProducer;
        private readonly IProducer<string, OrderUpdatedEvent> _updatedProducer;
        private readonly IProducer<string, OrderDeletedEvent> _deletedProducer;
        private readonly ILogger<OrderEventProducer> _logger;

        public OrderEventProducer(
            IProducer<string, OrderCreatedEvent> createdProducer,
            IProducer<string, OrderUpdatedEvent> updatedProducer,
            IProducer<string, OrderDeletedEvent> deletedProducer,
            ILogger<OrderEventProducer> logger)
        {
            _createdProducer = createdProducer ?? throw new ArgumentNullException(nameof(createdProducer));
            _updatedProducer = updatedProducer ?? throw new ArgumentNullException(nameof(updatedProducer));
            _deletedProducer = deletedProducer ?? throw new ArgumentNullException(nameof(deletedProducer));
            _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        }

        public async Task PublishCreatedAsync(OrderCreatedEvent evt)
        {
            try
            {
                var result = await _createdProducer.ProduceAsync(
                    KafkaTopics.OntologyEntityCreated,
                    new Message<string, OrderCreatedEvent>
                    {
                        Key = evt.EntityId,
                        Value = evt,
                        Headers = new Headers
                        {
                            { "entity-type", Encoding.UTF8.GetBytes("Order") },
                            { "event-type", Encoding.UTF8.GetBytes("Created") },
                            { "tenant-id", Encoding.UTF8.GetBytes(evt.TenantId) }
                        }
                    }
                );

                _logger.LogInformation("OrderCreated event published to {Topic} at offset {Offset}",
                    result.Topic, result.Offset);
            }
            catch (ProduceException<string, OrderCreatedEvent> ex)
            {
                _logger.LogError(ex, "Failed to publish OrderCreated event");
                throw;
            }
        }

        public async Task PublishUpdatedAsync(OrderUpdatedEvent evt)
        {
            try
            {
                var result = await _updatedProducer.ProduceAsync(
                    KafkaTopics.OntologyEntityUpdated,
                    new Message<string, OrderUpdatedEvent>
                    {
                        Key = evt.EntityId,
                        Value = evt,
                        Headers = new Headers
                        {
                            { "entity-type", Encoding.UTF8.GetBytes("Order") },
                            { "event-type", Encoding.UTF8.GetBytes("Updated") },
                            { "tenant-id", Encoding.UTF8.GetBytes(evt.TenantId) }
                        }
                    }
                );

                _logger.LogInformation("OrderUpdated event published to {Topic} at offset {Offset}",
                    result.Topic, result.Offset);
            }
            catch (ProduceException<string, OrderUpdatedEvent> ex)
            {
                _logger.LogError(ex, "Failed to publish OrderUpdated event");
                throw;
            }
        }

        public async Task PublishDeletedAsync(OrderDeletedEvent evt)
        {
            try
            {
                var result = await _deletedProducer.ProduceAsync(
                    KafkaTopics.OntologyEntityDeleted,
                    new Message<string, OrderDeletedEvent>
                    {
                        Key = evt.EntityId,
                        Value = evt,
                        Headers = new Headers
                        {
                            { "entity-type", Encoding.UTF8.GetBytes("Order") },
                            { "event-type", Encoding.UTF8.GetBytes("Deleted") },
                            { "tenant-id", Encoding.UTF8.GetBytes(evt.TenantId) }
                        }
                    }
                );

                _logger.LogInformation("OrderDeleted event published to {Topic} at offset {Offset}",
                    result.Topic, result.Offset);
            }
            catch (ProduceException<string, OrderDeletedEvent> ex)
            {
                _logger.LogError(ex, "Failed to publish OrderDeleted event");
                throw;
            }
        }
    }
}
